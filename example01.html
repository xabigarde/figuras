<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="UTF-8" />
  <title>Canvas experiment</title>
  <script src="figuras.js"></script>
  <script>

    const misFiguras = [];
    const FREQ_ANIMACION = 1; // unidad = ms


    function nuevaFiguraYDibujar() {
      let figtype = document.getElementById("figType").value;
      let userInput = document.getElementById("userInput").value;
      let datos = userInput.split(",").map(Number);
      if (!userInput) {
        window.alert("INTROCUDE UN VALOR!")
      }
      switch (figtype) {
        case "circulo": {
          let p = new Posicion(datos[1], datos[2]);
          let c = new Circulo(datos[0], p);
          misFiguras.push(c);
          break;
        }
        case "cuadrado": {
          console.log("dibujar cuadrado");
          let p = new Posicion(datos[1], datos[2]);
          let c = new Cuadrado(datos[0], p);
          misFiguras.push(c);
          break;
        }
        case "rectangulo": {
          console.log("dibujar rectangulo");
          let p = new Posicion(datos[2], datos[3]);
          let c = new Rectangulo(datos[0], datos[1], p);
          misFiguras.push(c);
          break;
        }
        default:
          console.log("dibujar ??");
      }

      //imprimirFiguras();

      dibujar();

    }

    function dibujar() {
      const canvas = document.getElementById("canvas");
      if (canvas.getContext) {
        const ctx = canvas.getContext("2d");

        //ctx.reset();
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (f of misFiguras) {
          switch (f.constructor.name) {
            case "Circulo": {
              ctx.beginPath();
              ctx.ellipse(f.centro[0], f.centro[1], f.radio, f.radio, 2 * Math.PI, 0, 2 * Math.PI);
              ctx.stroke();
              break;
            }
            case "Rectangulo": {
              ctx.fillStyle = "rgb(200, 0, 0)";
              ctx.fillRect(f.centro[0], f.centro[1], f.alto, f.ancho);
              break;
            }
            case "Cuadrado": {
              ctx.fillStyle = "rgb(200, 0, 0)";
              ctx.fillRect(f.centro[0], f.centro[1], f.alto, f.ancho);
              break;
            }
            default:
              console.log("ERROR: Figura no reconocida!")

          }
        }
      }
    }

    function imprimirFiguras() {
      for (f of misFiguras) {
        console.log(f)
      }
    }


    let animando = false; // flag de control
    function animar() {
      animando = !animando;
      if (animando)
        setTimeout(desplazar, FREQ_ANIMACION);
    }

    function desplazar() {
      if (animando) {
        desplazarFiguras();
        dibujar();
        setTimeout(desplazar, FREQ_ANIMACION);
        console.log("desplazar ha terminado!")
      }
    }

    let tocaMover = false;
    let previous_x = 0;
    let previous_y = 0;
    let next_x = 0;
    let next_y = 0;

    function desplazarFiguras() {
      if (tocaMover) {
        for (f of misFiguras) {
          next_x = generarProximaDirecci贸n(-1, 1)[0];
          next_y = generarProximaDirecci贸n(-1, 1)[1];


          f.posicion.px += next_x; // incrementar en 1 la posicion del eje X de esta figura F
          f.posicion.py += next_y; // incrementar en 1 la posicion del eje X de esta figura F

          if (f.posicion.px > 1500 - f.anchura()) {
            f.posicion.px = 1500 - f.anchura();
          }
          if (f.posicion.px < 0 + f.anchura()) {
            f.posicion.px = 0;
          }
          if (f.posicion.py > 800 - f.altura()) {
            f.posicion.py = 800 - f.altura();
          }
          if (f.posicion.py < 0 + f.altura()) {
            f.posicion.py = 0;
          }

        }
      }
      tocaMover = !tocaMover;
    }

    function getRndInteger(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    /*
        function getRndIntegerExceptCero(min, max) {
          let result = Math.floor(Math.random() * (max - min + 1)) + min
          if (result != 0)
            return result;
          return
          getRndIntegerExceptCero(min, max);
        }*/

    function generarProximaDirecci贸n(current_x, current_y) {
      next_x = getRndInteger(-1, 1);
      next_y = getRndInteger(-1, 1);
      if ((next_x != current_x && next_y != current_y))
        return generarProximaDirecci贸n(current_x, current_y);
      else
        return [next_x, next_y];
    }




  </script>
</head>

<body>
  <button onclick="nuevaFiguraYDibujar()" value="DIBUJAR!">DIBUJAR</button>
  <form>
    <input id="userInput">
    <select id="figType" name="figures">
      <option value="cuadrado">Cuadrado</option>
      <option value="circulo">Circulo</option>
      <option value="rectangulo">Rectangulo</option>
    </select>
  </form>

  <button onclick="animar()">ANIMAR</button>

  <br>
  <canvas id="canvas" width="1500" height="900" style="background-color:antiquewhite; border: solid black 1px"></canvas>
</body>

</html>